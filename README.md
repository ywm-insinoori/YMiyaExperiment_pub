# YMiyaExperiment_pub

Yuta Miyanishi's code examples from an experiment system developed in November-December 2023 with Python. 

このリポジトリでは、宮西雄太（3D Media Group, Tampere University）が2023年11-12月に実験のため作成したPythonスクリプト**の一部**を公開するものです。

## Brief description of the experiment

実験の目的は、次世代型3Dディスプレーであるライトフィールド（LF）ディスプレーに対して被験者の眼が生理的・光学的にどう反応するかを調べることでした。

各被験者はLFディスプレーによってさまざまな奥行きに表示された立体像を観察し、その間の眼の光学的状態を波面センサーにより記録しました。

## Experiment system and implementation

実験で用いたLFディスプレーは協力先のベンチャー企業 [CREAL SA., Lausanne, Switzerland](https://creal.com) が開発・設計・製造したプロトタイプであり、同社により機密保持契約のもと提供されたPythonによるAPIで制御します。ただし、あくまでプロトタイプでありAPIは一般に公開されていません。

また、LFディスプレーで表示した立体像に対する反応を正確に評価するために、実際にそれぞれの奥行きに置かれた実物に対する眼の反応も別に記録する必要がありました。実物にはミニモニター(Blackmagic Video Assist 4K)を用い、表示した像の正確な制御と、実験の自動化のためPsychoPyという既存ライブラリを用いました。

眼の光学状態の測定には市販の組み立て・キャリブレーション済みのハルトマンセンサーを用いました。当初は製品付属のデータ解析ソフトを別マシンで実行し、リアルタイムで生データを処理し解析が済んだデータをテキストストリームとして受け取ることを想定していました。しかし、測定対象（ヒトの眼）の特殊性に起因するダイナミックレンジの不足や解析データの不確実性が明らかになり、全く別のスクリプト（MATLAB上）で生データを記録する方式に切り替えました。

## Directories & Files

前述のようにLFディスプレー制御のためのAPIは一般公開されていないため、それを含むスクリプトは一切含められませんでした。本リポジトリでは、主に実験系のハード面のキャリブレーションや各コンポーネントのテストに用いたスクリプトを公開します。

* `HardCalib`: 実験系（ディスプレー・測定光学系）のキャリブレーション
  * `BM_RedspotFinder.py`: 光学系の設計上ディスプレーに表示した像と重なって見えてしまう赤い点について、その視野中の正確な位置を主観的に測定・記録するためのスクリプト。PsychoPyによる図形の表示とキーボードによる操作を組み合わせて実装。
  * `BMgammaTest.py`: ミニモニターのガンマカーブ（明るさの入力値に対して実際に得られる物理的輝度の関数）を測定するための表示側のスクリプト。輝度値の測定は専用の装置を別に使用。
* `PythonCommTest`: 当初の計画にあった、別マシン（ないし別アプリ）からのテキストストリームを受け取り記録するためのソケット通信
  * `FSlogging01.py`: チャタリングや空バッファなどの例外を想定した、比較的実用的な実装
  * `receiver01.py`: プリミティブな受信側のテストスクリプト
  * `sender01.py`: プリミティブな送信側のテストスクリプト
* `Tests`: 実験の自動進行、像の表示（ディスプレー制御）、キーボード操作などのコンポーネントのテスト
  * `Test_BMdisp_Landolt.py`: ミニモニター上で立体像（見かけの大きさが変化するランドルト環）を表示し、キーボードによる反応を受け取り、正答かどうかに基づいて次の像の大きさを決定する、実験のサブモジュールのテスト。クラス `LandoltC` の定義はルートディレクトリの同名ファイル参照。
  * `exprStairTest.py`, `exprStairTest2_simplestair.py`: 上のサブモジュールを実装する前の仮実装・テスト
  * `exprStairTest_savedata.py`: 応答データの記録・ファイルへの書き出しを pandas を用いて行ったテスト
  * `psychopykeyboardtest.py`: キーボード入力受け付けのプリミティブなテスト
* `ExperimentRunner_v03_REAL.py`: 実物に対する反応を測定・記録するセッションで用いた本番用スクリプト
* `LandoltC.py`: ディスプレーに表示される像を効率よく制御するためのクラス
